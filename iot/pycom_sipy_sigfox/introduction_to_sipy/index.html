<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Markus J&uuml;nemann">
        <link rel="canonical" href="https://mjuenema.github.io/iot/pycom_sipy_sigfox/introduction_to_sipy/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">

	<title>Pycom SiPy and Sigfox Introduction to SiPy - Markus J&uuml;nemann</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="../../../css/highlight.css">
        <link href="../../../css/base.css" rel="stylesheet">
        <link href="../../../extra.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../../..">Markus J&uuml;nemann</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../../..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../../../installing_gns3_on_centos7/">Installing GNS3 on CentOS 7</a>
                </li>
            
            
            
                <li >
                    <a href="../../../basic_ipv6_on_cisco_ios/">Basic IPv6 on Cisco IOS</a>
                </li>
            
            
            
                <li >
                    <a href="../../../testing_python_code_with_hypothesis/">Testing Python Code with Hypothesis</a>
                </li>
            
            
            
                <li >
                    <a href="../../../80211s_wireless_mesh/">802.11s Wireless Mesh Network</a>
                </li>
            
            
            
                <li >
                    <a href="../">Pycom SiPy and Sigfox</a>
                </li>
            
            
            
                <li >
                    <a href="../encrypting_sigfox_messages/">Pycom SiPy and Sigfox Encrypting Sigfox messages</a>
                </li>
            
            
            
                <li >
                    <a href="../firmware_upgrade/">Pycom SiPy and Sigfox Firmware Upgrade</a>
                </li>
            
            
            
                <li class="active">
                    <a href="./">Pycom SiPy and Sigfox Introduction to SiPy</a>
                </li>
            
            
            
                <li >
                    <a href="../sending_sigfox_message/">Pycom SiPy and Sigfox Sending Sigfox message</a>
                </li>
            
            
            
                <li >
                    <a href="../sigfox_backend/">Pycom SiPy and Sigfox Sending Sigfox message</a>
                </li>
            
            
            
                <li >
                    <a href="../sigfox_downlink/">Pycom SiPy and Sigfox Sending Sigfox message</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                <li >
                    <a rel="next" href="../firmware_upgrade/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../sending_sigfox_message/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/mjuenema">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#the-pycom-sipy">The Pycom Sipy</a></li>
        
            <li><a href="#connecting-to-the-sipy">Connecting to the SiPy</a></li>
        
            <li><a href="#the-flashbootpy-and-flashmainpy-scripts">The /flash/boot.py and /flash/main.py scripts</a></li>
        
            <li><a href="#micropython-on-sipy-examples">MicroPython on SiPy examples</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="the-pycom-sipy">The Pycom Sipy</h1>
<p>The <a href="https://www.pycom.io/product/sipy/">Pycom SiPy</a> is a multi-network (Sigfox, WiFi
and Bluetooth LE) development platform which is programmable with
<a href="https://micropython.org/">MicroPython</a>. The SiPy can be fitted into the
<a href="https://www.pycom.io/product/expansion-board-2-0/">Expansion board</a> which adds
USB power and console access as well as an SD card slot. Pycom also offer
hardware for LoRaWAN and LTE CAT M1/NB1 networks as well as other expansion
boards.</p>
<h2 id="connecting-to-the-sipy">Connecting to the SiPy</h2>
<p>The SiPy can be powered over the Expansion Boards micro-USB port which also
serves as the serial console.</p>
<pre><code>$ dmesg
[2371388.193802] usb 5-1: new full-speed USB device number 27 using ohci-pci
[2371388.357021] usb 5-1: New USB device found, idVendor=0403, idProduct=6015
[2371388.357033] usb 5-1: New USB device strings: Mfr=1, Product=2, SerialNumber=3
[2371388.357036] usb 5-1: Product: FT230X Basic UART
[2371388.357039] usb 5-1: Manufacturer: FTDI
[2371388.357041] usb 5-1: SerialNumber: DO0039D6
[2371388.363250] ftdi_sio 5-1:1.0: FTDI USB Serial Device converter detected
[2371388.363449] usb 5-1: Detected FT-X
[2371388.367270] usb 5-1: FTDI USB Serial Device converter now attached to ttyUSB0

$ cat /etc/minirc.sipy 
pu rtscts           No 
pu localecho        No

$ sudo minicom -D /dev/ttyUSB0 --noinit sipy
</code></pre>

<p>The console interface actually presents the interactive MicroPython prompt. This is
really nice for exploring and prototyping. Check the tutorial and reference sections
of the <a href="https://docs.pycom.io/">official documentation</a> to get started.</p>
<pre><code>&gt;&gt;&gt; import os
&gt;&gt;&gt; os.uname()
(sysname='SiPy', nodename='SiPy', release='1.7.3.b2', version='41c42b2-dirty on 2017-06-26', machine='SiPy with ESP32', sigfox='1.0.1')
</code></pre>

<p>Alternatively one can access the SiPy via Telnet but one has to configure the
WLAN interface first. </p>
<pre><code>&gt;&gt;&gt; from network import WLAN
&gt;&gt;&gt; wlan = WLAN(mode=WLAN.STA)
&gt;&gt;&gt; wlan.ifconfig(config='dhcp')
&gt;&gt;&gt; wlan.scan()
[(ssid='MYSSID', bssid=b'.......', sec=3, channel=12, rssi=-42)]
&gt;&gt;&gt; WLAN_SSID='MYSSID'
&gt;&gt;&gt; WLAN_KEY='MYKEY'
&gt;&gt;&gt; wlan.connect(ssid=WLAN_SSID, auth=(WLAN.WPA2, WLAN_KEY))
&gt;&gt;&gt; wlan.isconnected()
True
&gt;&gt;&gt; wlan.ifconfig()
('10.1.1.34', '255.255.255.0', '10.1.1.1', '10.1.1.1')
</code></pre>

<pre><code>$ telnet 10.1.1.34
Trying 10.1.1.34...
Connected to 10.1.1.34.
Escape character is '^]'.
MicroPython 41c42b2-dirty on 2017-06-26; SiPy with ESP32
Login as: micro
Password: python
Login succeeded!
Type &quot;help()&quot; for more information.
&gt;&gt;&gt;
CTRL-C
telnet&gt; quit
</code></pre>

<p>The SiPy also features a built-in FTP server which is required if one wants to
upload Python scripts to the device's flash memory.</p>
<pre><code>$ ftp 10.1.1.34
Connected to 10.1.1.34 (10.1.1.34).
220 Micropython FTP Server
Name (10.1.1.34:mjuenemann): micro
331 
Password:
230 
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
227 (10,1,1,34,7,232)
150 
drw-rw-r--   1 root  root         0 Jan  1  1985 flash
226 
ftp&gt; cd flash
250 
ftp&gt; ls
227 (10,1,1,34,7,232)
150 
-rw-rw-r--   1 root  root        34 Jan  1  2098 main.py
drw-rw-r--   1 root  root         0 Jan  1  2098 sys
drw-rw-r--   1 root  root         0 Jan  1  2098 lib
drw-rw-r--   1 root  root         0 Jan  1  2098 cert
-rw-rw-r--   1 root  root        29 Jan  1  2098 boot.py
226 
ftp&gt; bye
</code></pre>

<h2 id="the-flashbootpy-and-flashmainpy-scripts">The <code>/flash/boot.py</code> and <code>/flash/main.py</code> scripts</h2>
<p>The <code>boot.py</code> and <code>main.py</code> script implement the application logic of the SiPy.
The purpose of the boot script is to set-up the environment for the main script.
the boot script is run once after reset.
The main script is executed after the boot script and inherits the namespace, i.e.
any imports or variables defined in <code>boot.py</code> are available in <code>main.py</code>. The
default main script does nothing and it is up to the application developer
to create and upload a custom <code>main.py</code> script. </p>
<h2 id="micropython-on-sipy-examples">MicroPython on SiPy examples</h2>
<h3 id="reading-from-uart">Reading from UART</h3>
<pre><code>&gt;&gt;&gt; from machine import UART

&gt;&gt;&gt; uart = UART()
&gt;&gt;&gt; uart.init(baudrate=4800, bits = 8, parity = None, stop = 1, 
              pins = ('P3', 'P4'),     # P3=TX (G21 on Expansion Board), P4=Rx (G11)
              timeout_chars=10)        # Read timeout in chars/baudrate, if set too low readline() won't work!!!

&gt;&gt;&gt; if uart.any():
...     uart.readline()

uart.deinit()
</code></pre>

<h3 id="general-io-pins">General IO Pins</h3>
<p><strong>Output Pin example</strong></p>
<pre><code>&gt;&gt;&gt; from machine import Pin
&gt;&gt;&gt; pin_out = Pin('P8', mode=Pin.OUT)    # P8 = G15 on Expansion Board
&gt;&gt;&gt; pin_out.id()
'P8'

&gt;&gt;&gt; pin_out.value()
0

&gt;&gt;&gt; pin_out.value(1)
&gt;&gt;&gt; pin_out.value()
1

&gt;&gt;&gt; pin_out.toggle()
&gt;&gt;&gt; pin_out.value()
0
</code></pre>

<p><strong>Input Pin example</strong></p>
<p>The following example calls the <code>button_pressed()</code> function each time the
<em>BUTTON</em> (Pin 10) on the Expansion Board is pressed. Implementing this
through callbacks is a lot more efficient than polling the state of the
input pin. </p>
<pre><code>&gt;&gt;&gt; from machine import Pin

&gt;&gt;&gt; def button_pressed(pin):
...     print('button pressed')

&gt;&gt;&gt; pin_in = = Pin('P10', mode=Pin.IN, pull=Pin.PULL_UP)
&gt;&gt;&gt; pin.callback(Pin.IRQ_FALLING, button_pressed)
</code></pre>

<h3 id="idle-and-deepsleep">Idle and deepsleep</h3>
<p>There are three functions intended to save power consumption. The first one
is <code>machine.idle()</code> which stops the main script until the next interrupt.
Unfortunately ion the SiPy the system timer interrupt occurs every few
milliseconds so <code>machine.idle()</code> has probably very little effect.</p>
<p>The second function is <code>machine.deepsleep(ms)</code> and this one does justice to its
name. Calling <code>machine.deepsleep(ms)</code> will stop(!) the CPU and all peripherals
completely for a number of milliseconds. Not even an interrupt will wake the
system from its slumber. The big catch is that the system resets after it wakes
up again which makes for an interesting programming model:
work - deepsleep - reset - work - deepsleep, and so on.</p>
<pre><code>&gt;&gt;&gt; import machine
&gt;&gt;&gt; machine.deepsleep(2000)
ets Jun  8 2016 00:22:57

rst:0x5 (DEEPSLEEP_RESET),boot:0x13 (SPI_FAST_FLASH_BOOT)
configsip: 0, SPIWP:0x00
clk_drv:0x00,q_drv:0x00,d_drv:0x00,cs0_drv:0x00,hd_drv:0x00,wp_drv:0x00
mode:QIO, clock div:1
load:0x3fff9010,len:12
ho 0 tail 12 room 4
load:0x3fff9020,len:388
load:0x40078000,len:11412
load:0x4009fc00,len:848
entry 0x4009fd9c
MicroPython 41c42b2-dirty on 2017-06-28; SiPy with ESP32
Type &quot;help()&quot; for more information.

&gt;&gt;&gt;
</code></pre>

<p>Finally there is <code>machine.pin_deepsleep_wakeup()</code> which allows the system to
wake up from deep sleep through a pin. The <em>BUTTON</em> pin 10 comes to mind.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="../../../js/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/highlight.pack.js"></script>
        <script>var base_url = '../../..';</script>
        <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
        <script src="../../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>